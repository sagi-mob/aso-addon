<!DOCTYPE html>
<html>
<head>
		<!--
			<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
			-->
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<style>
			.logo { vertical-align: middle; }
			ul { list-style-type: none; padding: 0; }
			h4 { margin: 0; }
			legend {
              background-color: #000;
              color: #fff;
              padding: 3px 6px;
              margin-bottom: 3px;
			}
            select {
            width: 100%;
            }
			.output {
              font: 1rem 'Fira Sans', sans-serif;
			}
			fieldset, input {
              margin-bottom: 12px;
			}
            form {margin-top: 6px;}
            
            .fas {
              float: right;
              padding-top: 6px;
              cursor: pointer;
            }
            .fas:hover {
              color: #bfed4b;
            }
            
            #appsListStatusMsg { display: none; }
            
		</style>
		<base target="_top">
	</head>
	<body>
		<div class="container">
        
			<form class="form-group" id='main-form'>
                <fieldset>
                  <legend>OS:</legend>
                  <input class="" id='ios' type="radio" name="os" value='ios' checked="checked">
                  <label for="ios">iOS</label>
                  <input class="" id='android' type="radio" name="os" value='android'>
                  <label for="android">Android</label>
                </fieldset>
                
				
                
                <fieldset>
                
                    <div>
                      <legend>Select an App:<i id="refreshApps" class="fas fa-sync-alt" onclick="showAppsSuggestions()"></i> </legend> 
                      <select id="chosenApp">
                          
                      </select>
                      <h5 class="appsListStatusMsg" id="appsListStatusMsg">Done.</h5>
                    </div>
				</fieldset>
                
               <fieldset>
                  <legend>Country Code:</legend>
                  <input class="form-control" type="text" name="country" placeholder="Type Country Code Here">
                </fieldset>
                
				<div class="block" id="button-bar">
					<button class="btn btn-default" id="addApp">Add App!</button>
				</div>
				<h5 class="error" id="error"></h5>
                <h5 class="success" id="success"></h5>
			</form>
		</div>
	</body>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script>
		$(function() {
        showAppsSuggestions();
          $('#refreshApps').click(showAppsSuggestions);
		  $('#addApp').click(addApp);
          $('input[type=radio]').click(showAppsSuggestions);
		});
		
		/**
		 * Runs a server-side function to translate the text on all slides.
		 */
         
        
		function addApp() {
          var country = $('input[name=country]').val();
          var os = $('#chosenApp :selected').attr('os');
          var storeid = $('#chosenApp :selected').attr('storeid');
          var id = $('#chosenApp :selected').val();
          var name = $('#chosenApp :selected').text();
          var sheetName = "API " + name + " " + os + " " + country;
          
		  this.disabled = true;
		  google.script.run
		      .withSuccessHandler(printSuccess)
		      .withFailureHandler(printErr)
		      .withUserObject(this)
		      .addAnApp(id, name, os, country, storeid);
		}
        
        function showAppsSuggestions(){
        google.script.run.withSuccessHandler(function(appsList){
        $("#chosenApp option").remove();
        var os = $('input[name=os]:checked', '#main-form').val()
        var apps = appsList[os];
        
        $.each(apps, function(key, obj) {
            $("#chosenApp").append($("<option>")
            .attr('value', obj['mmpId'])
            .attr('os', os)
            .attr('name', obj['name'])
            .attr('storeid', obj['storeid'])
            .text(obj['name']));
          });
        }).getAppsApiList();
        }
        
        function printErr(err, element) {
            element.disabled = false;
            var errMsg = err || 'Something went wrong. Please check the add-on logs.';
            $('#error').text(errMsg).show();
            $('#error').delay(2000).fadeOut();
            return false;
        }
        
        function printSuccess(msg, element) {
            element.disabled = false;
            var sucMsg = msg || 'Done.';
            $('#success').text(sucMsg).show("fast");
            $('#success').delay(2000).fadeOut();
            return false;
        }
	</script>
</html>